#!/bin/sh
SHELL_NAME=$(basename "$SHELL")
case "$SHELL_NAME" in
  "bash")
    for FILE in bash.bashrc bash_completion; do
      [ -e "/etc/$FILE" ] && . "/etc/$FILE"
    done
    ;;
esac

motdheader() {
  echo "[$1]"
  echo "==="
}

motd() {
  data=$($@)
  if [ -z "$data" ]; then
    return
  fi
  motdheader "$1"
  echo "$data"
  echo
}

sshagent() {
  envfile="$HOME/.local/state/ssh-agent.env"
  mkdir -p "$(dirname "$envfile")"
  if ! pgrep -u "$USER" '^ssh-agent$' > /dev/null; then
    ssh-agent > "$envfile"
  fi
  export SSH_AUTH_SOCK="$HOME/.local/state/ssh-agent.socket"
  if [ ! -f "$SSH_AUTH_SOCK" ]; then
    . "$envfile" > /dev/null
  fi
  ssh-add "$HOME/.ssh/"*.privkey >/dev/null 2>&1
}

loadcomps() {
  [ -e "$HOME/.config/dotfiles/completions" ] && source "$HOME/.config/dotfiles/completions"
}

uncommitted() {
  if command -v git-uncommitted > /dev/null; then
    motd git uncommitted
  fi
}

shellready() {
  unset -f uncommitted loadcomps sshagent motd motdheader
}

export SECRET_ROOT="$HOME/.ttypty/secrets"
[ -d "$HOME/.local/bin" ] && export PATH="$HOME/.local/bin:$PATH"
