#!/bin/bash
dotfiles() {
  SHELL_NAME="$(basename "$SHELL")"
  echo ".${SHELL_NAME}rc"
  echo ".config/dotfiles/"
  echo ".local/bin/git-uncommitted"
  echo ".gitconfig"
  if command -v go > /dev/null; then
    echo ".local/bin/go-lint"
    echo ".local/bin/go-mod-updates"
    echo ".config/go/devtools"
  fi
  command -v kitty > /dev/null && echo ".config/kitty"
  command -v uv > /dev/null && echo ".config/uv"
  NEED_DEV=0
  case "$(uname)" in
    "Darwin")
      command -v container > /dev/null && echo ".local/bin/devcontainer"
      echo ".local/bin/is-screen-locked"
      echo ".local/bin/transcode-media"
      SWIFTBAR=".config/swiftbar"
      for ITEM in "$SWIFTBAR/"*; do
        NAME=$(basename "$ITEM" | cut -d "." -f 1)
        command -v "$NAME" > /dev/null && echo "$SWIFTBAR/$(basename "$ITEM")"
      done
      ;;
    "Linux")
      NEED_DEV=1
      ;;
  esac
  if [ "$NEED_DEV" -eq 1 ]; then
    [ -n "$EDITOR" ] && [ "$EDITOR" = "vim" ] && echo ".config/vim/"
    echo ".ssh/"
    echo ".config/git/"
    echo ".local/bin/devtools"
  fi
}

DIR=""
SET=""
FILE=""
[ -e "dotfiles.env" ] && source "dotfiles.env"
for SET in $(dotfiles | sort -u); do
  while IFS= read -r -d '' FILE; do
    echo "${FILE//$HOME/}"
    DIR=$(dirname "$FILE")
    [ "$DIR" != "." ] && mkdir -p "$HOME/$DIR"
    CMD="ln -sf"
    $CMD "$PWD/$FILE" "$HOME/$FILE"
  done < <(find "$SET" -type f -print0)
done
