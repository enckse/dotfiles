#!/bin/bash
[ -z "$DOTFILES_EDITOR" ] && echo "DOTFILES_EDITOR must be set" && exit 1

_install() {
  case "$(basename "$SHELL")" in
    "zsh")
      echo ".zshrc"
      ;;
  esac

  echo ".config/git/"
  command -v jj >/dev/null && echo ".config/jj/"
  command -v efm-langserver && echo ".config/efm-langserver/"
  echo ".config/dotfiles/"
  echo ".config/gu/"
  echo ".ssh/"
  case "$DOTFILES_EDITOR" in
    "hx")
      echo ".config/helix/"
      ;;
    "vim" | "nvim")
      echo ".config/$DOTFILES_EDITOR"
      ;;
    *)
      {
        echo
        echo "[ERROR] unknown editor: $DOTFILES_EDITOR"
        echo
      } >&2
      exit 1
      ;;
  esac
  case $(uname) in
    "Darwin")
      echo ".config/pkgv/"
      echo ".config/kitty/"
      ;;
  esac
}

DIR=""
SET=""
FILE=""
for SET in $(_install | sort -u); do
  while IFS= read -r -d '' FILE; do
    echo "${FILE//$HOME/}"
    DIR=$(dirname "$FILE")
    [ "$DIR" != "." ] && mkdir -p "$HOME/$DIR"
    CMD="ln -sf"
    $CMD "$PWD/$FILE" "$HOME/$FILE"
  done < <(find "$SET" -type f -print0)
done
