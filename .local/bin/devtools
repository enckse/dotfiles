#!/bin/sh -ue
CONFIG="$HOME/.config/dotfiles/devtools"
[ ! -e "$CONFIG" ] && exit 0
. "$CONFIG"
IDENTIFIER="$(dev_id)"
[ -z "$IDENTIFIER" ] && exit 0
IDENTIFIER="$IDENTIFIER.$(sha256sum "$CONFIG" | cut -c 1-7)"
CACHE="$HOME/.cache/devtools"
IDENTIFIER="$CACHE/$(echo "$IDENTIFIER" | sha256sum | cut -c 1-7)"
FORCE=0
[ $# -ge 1 ] && [ -n "$1" ] && [ "$1" = "--force" ] && FORCE=1
[ "$FORCE" -eq 0 ] && [ -e "$IDENTIFIER" ] && exit 0
echo "initializing develepment tools..."
mkdir -p "$CACHE"
find "$CACHE" -type f -mtime +1 -delete

_go_tools() {
  [ -z "$GOPATH" ] && return
  for BIN in $(go_tools); do
    echo "installing: $BIN"
    go install "$BIN@latest"
  done
}

_rust_tools() {
  ! command -v rustup > /dev/null && return
  rustup update
  for TOOL in $(rust_tools); do
    echo "installing: $TOOL"
    rustup component add "$TOOL"
  done
}

_npm_tools() {
  ! command -v npm >/dev/null && return
  for TOOL in $(npm_tools); do
    echo "installing: $TOOL"
    npm install -g "$TOOL"
  done
}

_go_tools
_rust_tools
_npm_tools
touch "$IDENTIFIER"
exit 0
