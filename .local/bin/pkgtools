#!/bin/sh -e
LIB="$HOME/.local/libexec/pkgtools"
[ -z "$1" ] && echo "command required" && exit 1
UPDATE="update"
VERS="versions"

_zsh() {
  cat << EOF
  #compdef _pkgtools pkgtools

_pkgtools() {
  local curcontext="\$curcontext" state len args
  typeset -A opt_args
  _arguments \\
    '1: :->main'\\
    '*: :->args'

  len=\${#words[@]}
  case \$state in
    main)
        _arguments "1:main:($UPDATE $VERS)"
    ;;
    *)
  esac
}

compdef _pkgtools pkgtools
EOF
}

case "$1" in
  "update")
    exec "$LIB/wrapper"
    ;;
  "versions")
    exec "$LIB/versions" "$2"
    ;;
  "completions")
    if [ "$(basename "$SHELL")" = "zsh" ]; then
      _zsh
      exit 0
    fi
    ;;
  *)
    echo "unknown command: $1"
    exit 1
esac
