#!/bin/bash

# 1. Get the absolute path of where you are right now
TARGET_DIR=$(pwd)
REAL_HOME=$HOME

# 2. Run bwrap under your CURRENT user
bwrap \
    --ro-bind / / \
    --proc /proc \
    --dev /dev \
    --tmpfs /tmp \
    --tmpfs "$REAL_HOME" \
    --bind "$TARGET_DIR" "$TARGET_DIR" \
    --bind "$REAL_HOME/.opencode" "$REAL_HOME/.opencode" \
    --chdir "$TARGET_DIR" \
    --setenv TERM "$TERM" \
    --setenv PATH "/usr/bin:/bin:$REAL_HOME/.opencode/bin" \
    --unshare-all \
    --share-net \
    --die-with-parent \
    opencode "$@"
